<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>• ⬡ The • Vibe • Hive ⬡ •</title>
    <meta name="description" content="A Hack the Hackathon v3 experience">
    
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.0/dist/aframe-environment-component.min.js"></script>

</head>
<body>
<script>

window.addEventListener('load', function() {
  document.getElementById('music').addEventListener('click', function() {
    document.getElementById('music').style.display = 'none';
    document.getElementById('soundcloud').style.display = 'block';
    document.getElementById('soundcloud').src = 'https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/157098949&color=%23a8b0b4&auto_play=true&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true';
  });
});

AFRAME.registerComponent('updater', {

  timePause: 6,
  timeTotal: 30,
  timeStart: null,
  textShown: '',
  textCurrent: '',
  textSpeed: 2,
	
	init: function()
	{
		this.writenow('breathe in.')
	},
	
	writenow: function (what) {
    if (this.textCurrent == what) return;
    this.textShown = '';
    this.textCurrent = what;
	},
	
	typeit: function() {
    let cur = this.textShown;
    const txt = this.textCurrent;
    if (cur.length < txt.length) {
      cur += txt.charAt(cur.length);
      this.textShown = cur;
      if (cur.length < txt.length) {
        cur += '|';
      }
      this.el.setAttribute("text", "value", cur);
      //console.log(this.textShown, this.textCurrent);
    }
  },

	tick: function (time, timeDelta) 
	{
    if (this.timeStart == null) {
      this.timeStart = time + ((this.timeTotal + this.timePause) * 1000);
    }
		let t = Math.round((this.timeStart - time)/1000);
		let newText = "𝅳           " + (t < 10 ? ' ' + t : t);
		let currentText = this.el.getAttribute("text")["value"];

		// only update if newText is different than current text displayed.
		if (newText != currentText && t < this.timeTotal && t > 0) {
			this.writenow(newText);
		}
		else if (t > this.timeTotal && t < this.timeTotal + 3) {
      this.writenow('breathe out ...')
		}
		else if (t < 1 && t > -5) {
      this.writenow("feeling the vibe");
		}
		else if (t < -4) {
      this.el.setAttribute("text", "color", "#fee190");
      this.writenow("The Vibe Hive");
		}
		
		this.typeit();		
	}
	
});

</script>
<a-scene>
	
	<a-assets>
		<img id="sky" src="assets/stemkoski-stars.jpg"  />
		<img id="sand" src="assets/Liiv - Siim Sepp - CC BY.jpg" />
		<img id="hexagons" src="assets/stemkoski-hexagons.png" />
		<img id="vibes" src="assets/goodvibes.jpg" />
		<a-asset-item id="pod" src="assets/pod.obj"></a-asset-item>

		<a-asset-item id="customFont" src="assets/helvetiker_regular.typeface.json"></a-asset-item>
		<a-asset-item id="pod" src="assets/pod.glb"></a-asset-item>
		<a-mixin id="light" geometry="primitive: sphere; radius: .25" light="color: #FFF; intensity: .5; type: point" material="shader: flat"></a-mixin>

	</a-assets>

	<a-sky 
		rotation = "0 0 0"
		color = "#FFFFFF"
		material = "src: #sky">
	</a-sky>
	
	<a-entity light="color: #fff; type: ambient"></a-entity>
  <a-entity mixin="light" position="0 0 70"></a-entity>

	<a-plane
		width="500" height="500"
		position=" 0.00 0.00 -5.00" 
		rotation="-90 0 0" 
		color="#888888" 
		material="src: #vibes; opacity:0.5; repeat:30 32; shader:phong; reflectivity: 0.9; shininess: 30;"
		animation__move="property: position; to: 60 -10 100; loop: false; dur: 30000"    
		animation__fade="delay: 3000; property: material.opacity; to: 0; loop: false; dur: 15000"

		shadow="cast: false; receive: true">
	</a-plane>
	
  <a-entity 
    id="textArea"
    scale="30 30 1"
    position=" 10.5 3.00 -5.00" 
    material="color: #AAAAFF; src: #hexagons; repeat: 20 20;"
    text="value: |;"
    updater>
  </a-entity>
    
  <a-entity
    id="thePod"
    obj-model="obj: #pod;"
    material="opacity: 0.4; src: #hexagons; repeat: 68 68; side: double; shader:phong; reflectivity: 0.9; shininess: 30;"
    animation__fade="property: material.opacity; to: 0; loop: false; dur: 30000"
    animation__move="delay: 5000; property: position; to: 0 3 -3; loop: false; dur: 30000"   
    scale="1.5 1.5 1.5"
    position="0 3 -8"
    rotation="0 -45 0"
		shadow="cast: true">
  </a-entity>

	
</a-scene>

<div id="music" title="Open Soundcloud">♪</div>
<iframe id="soundcloud" width="400" height="80" scrolling="no" frameborder="no" allow="autoplay" src="" style="display:none"></iframe>
<style type="text/css">
#music, #soundcloud {
  position: fixed; 
  z-index: 999; 
  bottom: 0px; 
  left: 0px;
}
#music {
  font-size: 60pt;
  color: white;
  padding: 0.2em 0.5em;
  cursor: pointer;
}
</style>
</body>
</html>